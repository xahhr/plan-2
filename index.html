<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Taper Plan Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:20px; }
    h1 { text-align:center; }
    table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; }
    th, td { border:1px solid #ccc; padding:10px; text-align:center; }
    th { background:#eee; }
    input { width:60px; text-align:center; }
    .warning { color:red; font-weight:bold; }
    .stock { font-size:0.9em; color:#333; }
  </style>
</head>
<body>
  <h1>6-Week Withdrawal Plan</h1>

  <table>
    <thead>
      <tr>
        <th>Drug</th>
        <th>Max Daily Dose</th>
        <th>Today's Dose</th>
        <th>Remaining Stock</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="drugTable">
      <!-- rows will be inserted by JS -->
    </tbody>
  </table>

  <script>
    // Initial stock (example values — adjust based on actual boxes you have)
    let drugs = [
      { name: "Night Calm (mg)", max: 12, stock: 60 },
      { name: "Armodafinil (mg)", max: 150, stock: 30 },
      { name: "Gabapentin (mg)", max: 2400, stock: 90 },
      { name: "Caffeine/Sugar (unit)", max: 2, stock: 60 }
    ];

    function renderTable() {
      let tbody = document.getElementById("drugTable");
      tbody.innerHTML = "";
      drugs.forEach((drug, i) => {
        let row = document.createElement("tr");

        // drug name
        let nameTd = document.createElement("td");
        nameTd.textContent = drug.name;
        row.appendChild(nameTd);

        // max daily
        let maxTd = document.createElement("td");
        maxTd.textContent = drug.max;
        row.appendChild(maxTd);

        // input dose
        let doseTd = document.createElement("td");
        let input = document.createElement("input");
        input.type = "number";
        input.min = 0;
        input.max = drug.max * 2; // allow some error margin
        input.dataset.index = i;
        input.addEventListener("input", updateDose);
        doseTd.appendChild(input);
        row.appendChild(doseTd);

        // remaining stock
        let stockTd = document.createElement("td");
        stockTd.className = "stock";
        stockTd.id = "stock-" + i;
        stockTd.textContent = drug.stock;
        row.appendChild(stockTd);

        // status
        let statusTd = document.createElement("td");
        statusTd.id = "status-" + i;
        row.appendChild(statusTd);

        tbody.appendChild(row);
      });
    }

    function updateDose(e) {
      let index = e.target.dataset.index;
      let val = parseInt(e.target.value) || 0;
      let drug = drugs[index];
      let status = document.getElementById("status-" + index);
      let stockTd = document.getElementById("stock-" + index);

      // check warning
      if (val > drug.max) {
        status.textContent = "⚠ Overdose!";
        status.className = "warning";
      } else {
        status.textContent = "✔ OK";
        status.className = "";
      }

      // update stock (assumes each unit entered = 1 pill/mg unit consumed)
      let used = val;
      let remaining = drug.stock - used;
      if (remaining < 0) remaining = 0;
      stockTd.textContent = remaining;
    }

    renderTable();
  </script>
</body>
</html>
